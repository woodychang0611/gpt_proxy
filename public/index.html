<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.rawgit.com/showdownjs/showdown/1.9.0/dist/showdown.min.js"></script>
    <title>Playground</title>
</head>

<body>
    <div class="container-sm mt-5">
        <input type="password" id="key" rows="1" cols="80" width="100"></textarea>
        <br>
        <textarea id="question" rows="4" cols="80"></textarea>
        <br>
        <button id="submit" type="button" class="btn btn-primary active" onclick="submitQuestion()">Submit</button>

        <h2>Answer:</h2>
        <div id="answer"></div>
    </div>
    <script>
        function submitQuestion() {
            let questionText = document.getElementById('question').value;
            let keyText = document.getElementById('key').value;
            document.getElementById("submit").disabled = true;
            document.getElementById('answer').innerHTML = '<img src="loading.svg"/>'
            fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ key: keyText, question: questionText })
            })
                .then(response => response.json())
                .then(data => {
                    const converter = new showdown.Converter();
                    let htmlOutput = converter.makeHtml(data.answer);
                    if (htmlOutput == undefined) {
                        htmlOutput = '<p class="text-danger">Failed</p>'
                    }

                    document.getElementById('answer').innerHTML = htmlOutput;
                })
                .catch(error => {
                    console.error('Error:', error);
                }).finally(() => { document.getElementById("submit").disabled = false }
                )
            document.getElementById("submit").disabled = false
        }
    </script>

</body>

</html>